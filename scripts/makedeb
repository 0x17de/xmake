#!/bin/bash

# install fpm
# apt-get install ruby ruby-dev rubygems gcc make
# gem install --no-ri --no-rdoc fpm

# version
version=2.1.3

# build xmake core
cd ./core
make f DEBUG=n
make r
cd -

# make xmake wrapper
echo "#/!bin/bash
export XMAKE_PROGRAM_DIR=/usr/local/share/xmake
/usr/local/share/xmake/xmake \"\$@\"
" > /tmp/xmake.sh
chmod 755 /tmp/xmake.sh

# make dep package using fpm
fpm -s dir -t deb -n xmake -v $version -m "<waruqi@gmail.com>" --description="A make-like build utility based on Lua" --license=LICENSE.md \
        xmake=/usr/local/share/ \
        core/bin/demo.pkg/bin/linux/x86_64/demo.b=/usr/local/share/xmake/xmake \
        /tmp/xmake.sh=/usr/local/bin/xmake


